#!/bin/sh
script_abs=$(readlink -f "$0")
script_dir=$(dirname $script_abs)
lib_dir=$script_dir/../lib
log_dir=$lib_dir/log

# NR List文件库位置
nrlist_dir=/home/omnisky/space/wyh/NRdatabase_v11/NRlist_1.1
files=$(ls $nrlist_dir)

# 精度设定
precision=XP

starttime=$(date)

echo
echo Start at: $starttime
echo

for dir in $lib_dir $log_dir
do
    if [ ! -d $dir ];then
        echo "$dir does not exist. It will be created."
        mkdir $dir
    fi
done

if [ $# -eq 0 ];then
    for filename in $files
    do
        gene=${filename%.*}
        # 后缀设定计算参数
        $script_dir/py4schrodinger -r $nrlist_dir/$filename -p $precision -n 48 -m -k > $script_dir/../lib/log/${gene}_${precision}.log
    done
else
    for filename in $files
    do
        gene=${filename%.*}
        lig=$(readlink -f "$1")
        ligname=$(basename $lig)
        ligname=${ligname%.*}
        $script_dir/py4schrodinger -r $nrlist_dir/$filename -l ${lig} -p $precision -n 48 -m -k > $script_dir/../lib/log/${gene}_${precision}_$ligname.log
    done
    echo EX-LIGAND: $1
fi
endtime=$(date)

echo Autorun Complete

echo Precision: $precision
echo Start at: $starttime
echo Jobs Complete at: $endtime