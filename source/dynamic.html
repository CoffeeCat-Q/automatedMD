<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Quick User Guide &mdash; pyCADD  文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="pyCADD" href="modules.html" />
    <link rel="prev" title="Gauss Quick Start" href="gauss.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pyCADD
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Dock Module input file format</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="input_file_fmt.html">构建Dock输入文件时的规范</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dock.html">Dock Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="dance.html">Dance User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="gauss.html">Gauss Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dynamic Quick User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">文件准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pythondynamic">Python包调用Dynamic模块</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">蛋白结构准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">小分子结构准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#amber-leap">Amber模拟前准备-LEaP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">创建输入文件执行模拟</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cli-dynamic">CLI 调用Dynamic模块</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">pyCADD</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyCADD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Dynamic Quick User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/dynamic.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dynamic-quick-user-guide">
<h1>Dynamic Quick User Guide<a class="headerlink" href="#dynamic-quick-user-guide" title="永久链接至标题"></a></h1>
<p>pyCADD.Dynamic 模块是为分子动力学模拟的自动化准备与运行而开发的功能模块，目的是为了让研究者专注在分子动力学模拟结果以及少数关键参数上，而无需关心和学习分子动力学模拟准备与执行的具体代码和流程或管道，以期能够提高学术问题的研究效率。</p>
<p>pyCADD提供了Python包调用和CLI(命令行工具)调用两种方式，其中CLI调用方式更加方便，但是Python包调用方式更加灵活。</p>
<section id="id1">
<h2>文件准备<a class="headerlink" href="#id1" title="永久链接至标题"></a></h2>
<p>Dynamic模块只需要最少的必要输入和几个关键参数调节即可快速开始模拟过程。</p>
<p>要快速执行蛋白-小分子相互作用的分子动力学模拟，首先，您需要准备好一个开展模拟的蛋白结构文件 <code class="docutils literal notranslate"><span class="pre">protein_file</span></code> ，以及一个需要模拟的小分子文件 <code class="docutils literal notranslate"><span class="pre">molecule_file</span></code>, 2个文件都必须是PDB格式(<code class="docutils literal notranslate"><span class="pre">.pdb</span></code>)。</p>
<ul class="simple">
<li><p>为了顺利执行模拟过程，2个结构的坐标应该是“合理”且“相近的”，即分子和蛋白的坐标应该在同一个空间区域中，且分子位于可能结合的位点上。因此，结构应该来自于分子对接软件的对接结果，或X-ray的衍射结构。</p></li>
<li><p>在研究一个新分子的动力学模拟前，应该先将其分子对接到相应的蛋白位点上，然后使用分子对接软件输出PDB格式结构。例如使用 Schrodinger Maestro 将纯蛋白部分与配体小分子拆分，然后<strong>分别</strong>输出为<code class="docutils literal notranslate"><span class="pre">.pdb</span></code>文件。</p></li>
<li><p>蛋白文件不应该包含任何配体小分子及任何水分子，小分子结构也不应该包含任何水分子。</p></li>
<li><p>如果使用 pyCADD.Dock 模块进行过分子对接，则可在 <code class="docutils literal notranslate"><span class="pre">protein</span></code> 及 <code class="docutils literal notranslate"><span class="pre">ligand</span></code> 目录下找到已经拆分好的蛋白和配体小分子的PDB格式结构文件。</p></li>
</ul>
</section>
<section id="pythondynamic">
<h2>Python包调用Dynamic模块<a class="headerlink" href="#pythondynamic" title="永久链接至标题"></a></h2>
<p>首先 从模块中导入结构预处理器 <code class="docutils literal notranslate"><span class="pre">Processor</span></code> 及实施分子动力学模拟的模拟器 <code class="docutils literal notranslate"><span class="pre">Simulator</span></code>, 然后创建一个预处理器实例 <code class="docutils literal notranslate"><span class="pre">processor</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyCADD.Dynamic</span> <span class="kn">import</span> <span class="n">Processor</span><span class="p">,</span> <span class="n">Simulator</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">Processor</span><span class="p">()</span>     <span class="c1"># 实例化的同时，将在当前目录创建所有必要的文件夹</span>
</pre></div>
</div>
<section id="id2">
<h3>蛋白结构准备<a class="headerlink" href="#id2" title="永久链接至标题"></a></h3>
<p>使用processor的protein_prepare()方法 对蛋白结构文件进行自动预处理工作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">processor</span><span class="o">.</span><span class="n">protein_prepare</span><span class="p">(</span><span class="n">protein_file</span><span class="p">)</span>
</pre></div>
</div>
<p>这一过程包括以下几个步骤(需要AmberTools)：</p>
<ol class="simple">
<li><p>去除蛋白结构中所有的水分子, 并补充标准氨基酸残基缺失的原子(add missing atoms), 得到后缀为<code class="docutils literal notranslate"><span class="pre">_dry.pdb</span></code>的文件。</p></li>
<li><p>去除蛋白结构中的所有“原生”H原子，得到后缀为<code class="docutils literal notranslate"><span class="pre">_noH.pdb</span></code>的文件。</p></li>
<li><p>使用AmberTools为蛋白结构重新生成蛋白力场下的H原子，得到后缀为<code class="docutils literal notranslate"><span class="pre">_leap.pdb</span></code>的文件。</p></li>
</ol>
<p>所有此步骤的过程文件保存在<code class="docutils literal notranslate"><span class="pre">protein</span></code>目录中。</p>
</section>
<section id="id3">
<h3>小分子结构准备<a class="headerlink" href="#id3" title="永久链接至标题"></a></h3>
<p>使用processor的molecule_prepare()方法 对小分子结构文件进行自动预处理工作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># charge指定小分子结构的电荷量 根据实际情况改变 </span>
<span class="c1"># 当charge与实际不符时 Gaussian将报错 默认为0</span>
<span class="c1"># multiplicity指定小分子自旋多重度 默认为1</span>

<span class="n">processor</span><span class="o">.</span><span class="n">molecule_prepare</span><span class="p">(</span><span class="n">molecule_file</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>这一过程包括以下几个步骤：</p>
<ol class="simple">
<li><p>高斯结构优化 (需要Gaussian 16, 使用泛函B3LYP、基组def2SVP、色散矫正em=GD3BJ、loose收敛限)</p></li>
<li><p>计算小分子的RESP2电荷 (需要Multiwfn)并生成输出PDB结构<code class="docutils literal notranslate"><span class="pre">_out.pdb</span></code> 关于RESP2(0.5)电荷的更多信息，参阅<a class="reference external" href="http://sobereva.com/531">RESP2(0.5)电荷</a></p></li>
<li><p>antechamber (需要AmberTools) 生成Amber模拟模型参数文件<code class="docutils literal notranslate"><span class="pre">.prepin</span></code></p></li>
<li><p>parmchk2 (需要AmberTools) 生成Amber模拟模型参数文件<code class="docutils literal notranslate"><span class="pre">.frcmod</span></code>
所有此步骤的过程文件保存在<code class="docutils literal notranslate"><span class="pre">molecule</span></code>目录中。</p></li>
</ol>
</section>
<section id="amber-leap">
<h3>Amber模拟前准备-LEaP<a class="headerlink" href="#amber-leap" title="永久链接至标题"></a></h3>
<p>在蛋白与小分子都准备就绪后，使用LEaP来完成最终的模拟准备文件生成。
为了方便识别生成文件，选择一个任意名称作为生成文件前缀名 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> ，这通常可以是PDBID或配体小分子名等。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;1FBY&#39;</span>
<span class="n">processor</span><span class="o">.</span><span class="n">leap_prepare</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</pre></div>
</div>
<p>这一过程包括以下几个步骤：</p>
<ol class="simple">
<li><p>创建tleap命令的输入文件 <code class="docutils literal notranslate"><span class="pre">_tleap.in</span></code></p></li>
<li><p>调用tleap命令为蛋白结构(pro)、小分子结构()lig以及二者复合物(com)生成必要的拓扑及坐标文件<code class="docutils literal notranslate"><span class="pre">.prmtop</span></code>、<code class="docutils literal notranslate"><span class="pre">.inpcrd</span></code></p></li>
<li><p>将复合物溶于TIP3P水箱中(size 12.0) 得到水箱复合物结构文件(<code class="docutils literal notranslate"><span class="pre">_comsolvate.pdb</span></code>)，并同时生成拓扑与坐标文件<code class="docutils literal notranslate"><span class="pre">_comsolvate.prmtop</span></code>、<code class="docutils literal notranslate"><span class="pre">_comsolvate.inpcrd</span></code></p></li>
</ol>
<p>所有此步骤的过程文件保存在<code class="docutils literal notranslate"><span class="pre">leap</span></code>目录中。</p>
<p>现在，如果没有产生预料之外的错误，预处理阶段已经完成。</p>
</section>
<section id="id4">
<h3>创建输入文件执行模拟<a class="headerlink" href="#id4" title="永久链接至标题"></a></h3>
<p>为了开始模拟阶段，首先 创建模拟器实例<code class="docutils literal notranslate"><span class="pre">simulator</span></code>，它需要此前的预处理器实例<code class="docutils literal notranslate"><span class="pre">processor</span></code>来完成构造工作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 如果您需要不执行准备阶段直接进行模拟，可以构建一个新的Processor实例</span>
<span class="c1"># 并使用set_comsolvate_file(file_path:str, file_type:str)来设定已存在的水箱复合物结构3个必要文件路径</span>
<span class="c1"># 包括_comsolvate.pdb _comsolvate.prmtop _comsolvate.inpcrd</span>
<span class="c1"># new_processor = Processor()</span>
<span class="c1"># new_processor.set_comsolvate_file(&#39;leap/*_comsolvate.pdb&#39;, &#39;pdb&#39;)</span>
<span class="c1"># new_processor.set_comsolvate_file(&#39;leap/*_comsolvate.prmtop&#39;, &#39;top&#39;)</span>
<span class="c1"># new_processor.set_comsolvate_file(&#39;leap/*_comsolvate.inpcrd&#39;, &#39;crd&#39;)</span>

<span class="n">simulator</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
<span class="c1"># simulator = Simulator(new_processor)</span>
</pre></div>
</div>
<p>创建Amber模拟所需的一切输入文件将由creat_input_file()方法完成, 您只需要指定模拟步数及模拟步长2个参数。
模拟步数及步长决定了模拟的总时间长度 默认将为100ns。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># step_num代表模拟步数 默认为50000000步</span>
<span class="c1"># step_length代表模拟步长 默认为0.002ps</span>
<span class="c1"># 模拟总时长 = step_num * step_length</span>
<span class="c1"># 默认总时长 = 50000000 * 0.002 ps = 100000 ps = 100ns</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">create_input_file</span><span class="p">(</span><span class="n">step_num</span><span class="o">=</span><span class="mi">50000000</span><span class="p">,</span> <span class="n">step_length</span><span class="o">=</span><span class="mf">0.002</span><span class="p">)</span>
</pre></div>
</div>
<p>最后 设定模拟使用的GPU设备编号，即可开始模拟。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用shwo_cuda_device()查看当前GPU信息</span>
<span class="c1"># simulator.show_cuda_device()</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">set_cuda_device</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">simulator</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span>
<span class="c1"># or </span>
<span class="c1"># simulator.run_simulation(cuda_device=0)</span>
</pre></div>
</div>
<p>进程将阻塞至模拟完成。</p>
</section>
</section>
<section id="cli-dynamic">
<h2>CLI 调用Dynamic模块<a class="headerlink" href="#cli-dynamic" title="永久链接至标题"></a></h2>
<p>使用命令</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycadd-dynamic <span class="o">[</span>option<span class="o">]</span> protein_file molecule_file
</pre></div>
</div>
<p>即可快速完成以上全部过程。</p>
<p>A simple demo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir 1FBY
<span class="nb">cd</span> 1FBY
cp SOMEWHERE/1FBY-pro-9CR.pdb ./
cp SOMEWHERE/1FBY-lig-9CR.pdb ./
pycadd-dynamic --charge -1 --multiplicity <span class="m">1</span> --prefix 1FBY --parallel <span class="m">48</span> --with-gpu <span class="m">0</span> 1FBY-pro-9CR.pdb 1FBY-lig-9CR.pdb
</pre></div>
</div>
<p>使用</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pycadd-dynamic --help
</pre></div>
</div>
<p>获取参数设定的更多信息。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gauss.html" class="btn btn-neutral float-left" title="Gauss Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="modules.html" class="btn btn-neutral float-right" title="pyCADD" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Yuhang.W.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>